<app-header [headerClass]="'light_header'"></app-header>

<!-- Futuristic Hero Section -->
<div class="hero-container">
    <div class="hero-content">
        <div class="hero-animation">
            <div class="orbit">
                <div class="planet"></div>
                <div class="plane-orbit">
                    <i class="fas fa-plane"></i>
                </div>
            </div>
        </div>
        <h1 class="glitch-text" data-text="Future of Travel">Tuba International Flight</h1>
        <p class="neon-text">Experience seamless flight booking with AI-powered recommendations</p>
    </div>
    <div class="hero-overlay"></div>
</div>

<!-- Main Booking Section -->
<section class="booking-container">
    <div class="glass-container">
        <div class="row g-4">
            <!-- Left Column: Booking Form -->
            <div class="col-lg-7">
                <div class="neo-card">
                    <!-- Interactive Progress -->
                    <div class="progress-tracker">
                        <div class="progress-line" [style.width.%]="(currentStep/3)*100"></div>
                        <div class="progress-steps">
                            <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
                                <div class="step-icon">
                                    <i class="fas fa-globe"></i>
                                </div>
                                <span>Route</span>
                            </div>
                            <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
                                <div class="step-icon">
                                    <i class="fas fa-user"></i>
                                </div>
                                <span>Details</span>
                            </div>
                            <div class="step" [class.active]="currentStep >= 3">
                                <div class="step-icon">
                                    <i class="fas fa-check"></i>
                                </div>
                                <span>Confirm</span>
                            </div>
                        </div>
                    </div>

                    <!-- Add this after the progress-tracker -->
                    <div class="error-toast" *ngIf="errorMessage">
                        <i class="fas fa-exclamation-circle"></i>
                        {{ errorMessage }}
                    </div>

                    <!-- Futuristic Form -->
                    <form [formGroup]="flightForm" (ngSubmit)="onSubmit()" class="neo-form">
                        <!-- Flight Route Fields (Step 1) -->
                        <div class="form-fields" [class.active]="currentStep === 1">
                            <div class="floating-input">
                                <div class="input-wrapper">
                                    <i class="fas fa-plane-departure"></i>
                                    <input type="text" formControlName="fromLocation" 
                                        placeholder="From"
                                        [class.is-invalid]="fromLocationControl?.invalid && fromLocationControl?.touched">
                                    <div class="input-glow"></div>
                                </div>
                                <div class="error-message" *ngIf="fromLocationError">{{ fromLocationError }}</div>
                            </div>

                            <div class="floating-input">
                                <div class="input-wrapper">
                                    <i class="fas fa-plane-arrival"></i>
                                    <input type="text" formControlName="toLocation" 
                                        placeholder="To"
                                        [class.is-invalid]="toLocationControl?.invalid && toLocationControl?.touched">
                                    <div class="input-glow"></div>
                                </div>
                                <div class="error-message" *ngIf="toLocationError">{{ toLocationError }}</div>
                            </div>

                            <div class="form-grid">
                                <div class="floating-input">
                                    <div class="input-wrapper">
                                        <i class="fas fa-calendar"></i>
                                        <input type="date" formControlName="departureDate" 
                                            [min]="minDate"
                                            [class.is-invalid]="departureDateControl?.invalid && departureDateControl?.touched">
                                        <div class="input-glow"></div>
                                    </div>
                                    <div class="error-message" *ngIf="departureDateError">{{ departureDateError }}</div>
                                </div>

                                <div class="floating-input">
                                    <div class="input-wrapper">
                                        <i class="fas fa-users"></i>
                                        <input type="number" formControlName="passengers" 
                                            placeholder="Passengers"
                                            min="1" max="9"
                                            [class.is-invalid]="passengersControl?.invalid && passengersControl?.touched">
                                        <div class="input-glow"></div>
                                    </div>
                                    <div class="error-message" *ngIf="passengersError">{{ passengersError }}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Passenger Details Fields (Step 2) -->
                        <div class="form-fields" [class.active]="currentStep === 2">
                            <h3 class="section-title">Passenger Details</h3>
                            
                            <div class="floating-input">
                                <div class="input-wrapper">
                                    <i class="fas fa-user"></i>
                                    <input type="text" formControlName="name" 
                                        placeholder="Full Name"
                                        [class.is-invalid]="nameControl?.invalid && nameControl?.touched">
                                    <div class="input-glow"></div>
                                </div>
                                <div class="error-message" *ngIf="nameError">{{ nameError }}</div>
                            </div>

                            <div class="form-grid">
                                <div class="floating-input">
                                    <div class="input-wrapper">
                                        <i class="fas fa-envelope"></i>
                                        <input type="email" formControlName="email" 
                                            placeholder="Email Address"
                                            [class.is-invalid]="emailControl?.invalid && emailControl?.touched">
                                        <div class="input-glow"></div>
                                    </div>
                                    <div class="error-message" *ngIf="emailError">{{ emailError }}</div>
                                </div>

                                <div class="floating-input">
                                    <div class="input-wrapper">
                                        <i class="fas fa-phone"></i>
                                        <input type="tel" formControlName="phone" 
                                            placeholder="Phone Number"
                                            (input)="onPhoneInput($event)"
                                            [class.is-invalid]="phoneControl?.invalid && phoneControl?.touched">
                                        <div class="input-glow"></div>
                                    </div>
                                    <div class="error-message" *ngIf="phoneError">{{ phoneError }}</div>
                                </div>
                            </div>

                            <!-- Additional Services -->
                            <div class="additional-services">
                                <h3 class="section-title">Additional Services</h3>
                                <div class="service-options">
                                    <label class="neo-checkbox">
                                        <input type="checkbox" formControlName="travel_insurance">
                                        <span class="checkbox-label">
                                            <i class="fas fa-shield-alt"></i>
                                            Travel Insurance
                                        </span>
                                    </label>
                                    <label class="neo-checkbox">
                                        <input type="checkbox" formControlName="airport_pickup">
                                        <span class="checkbox-label">
                                            <i class="fas fa-car"></i>
                                            Airport Pickup
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Confirmation Fields (Step 3) -->
                        <div class="form-fields" [class.active]="currentStep === 3">
                            <div class="confirmation-summary">
                                <h3 class="section-title">Review Your Booking</h3>
                                <div class="summary-grid">
                                    <div class="summary-item">
                                        <span class="label">From</span>
                                        <span class="value">{{ flightForm.get('fromLocation')?.value }}</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="label">To</span>
                                        <span class="value">{{ flightForm.get('toLocation')?.value }}</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="label">Date</span>
                                        <span class="value">{{ flightForm.get('departureDate')?.value | date }}</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="label">Passengers</span>
                                        <span class="value">{{ flightForm.get('passengers')?.value }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Navigation -->
                        <div class="form-actions">
                            <button type="button" class="neo-button" 
                                    *ngIf="currentStep > 1"
                                    (click)="previousStep()">
                                <i class="fas fa-arrow-left"></i>
                                <span>Back</span>
                            </button>
                            <button type="button" class="neo-button primary" 
                                    *ngIf="currentStep < 3"
                                    (click)="nextStep()"
                                    [class.disabled]="!isFormValid">
                                <span>{{ isFormValid ? 'Next' : 'Complete Required Fields' }}</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                            <button type="submit" class="neo-button primary" 
                                    *ngIf="currentStep === 3"
                                    [disabled]="!flightForm.valid || isSubmitting">
                                <span>{{ isSubmitting ? 'Processing...' : 'Book Now' }}</span>
                                <div class="button-glow"></div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Right Column: Summary -->
            <div class="col-lg-5">
                <app-flight-booking-summary 
                    [flightDetails]="currentBooking"
                    [isLoading]="isLoadingSummary">
                </app-flight-booking-summary>
            </div>
        </div>
    </div>
</section>

<app-footer [location]="true"></app-footer>
<app-layout></app-layout>
